#!/bin/bash
server=`grep  \"server\" /home/petya/work/Webkey/webkey/res/values/strings.xml | cut -d ">" -f 2 | cut -d "<" -f 1`
VER=`grep android:versionName= /home/petya/work/Webkey/webkey/AndroidManifest.xml | grep -o \".*\" | cut -d "\"" -f 2`
cat mongoose.c | sed -r "s/WEBKEYVERSION/$VER/g" | sed -r "s/WEBKEYSERVER/$server/g" > tmp_mongoose.c
#../build/prebuilt/linux-x86/arm-eabi-4.4.0/bin/arm-eabi-g++ -DANDROID -Wl,-rpath-link=../build/platforms/android-3/arch-arm/usr/lib/,-dynamic-linker=/system/bin/linker -nostdlib -I ../build/platforms/android-3/arch-arm/usr/include/ -L ../build/platforms/android-3/arch-arm/usr/lib/ -lc -llog crt0.o shellinabox/service.c shellinabox/launcher.c shellinabox/logging.c shellinabox/hashmap.c webkey.c suinput.c tmp_mongoose.c base64.c  ../build/prebuilt/linux-x86/arm-eabi-4.4.0/arm-eabi/lib/libstdc++.a libpng12.a libjpeg.a -lz -o webkey -O2  && ../build/prebuilt/linux-x86/arm-eabi-4.4.0/bin/arm-eabi-strip webkey && echo OK && cp -r -f sqlite3 webkey ShellInABox.js beep.wav styles.css keyboard.png enabled.gif *.html favicon.ico fast_keys.txt *.png spec_keys.txt notify.txt ae_* client plugins /home/petya/work/Webkey/webkey/assets/webkey/ && cd /home/petya/work/Webkey/ && ./buildapk_petya.sh && cd -
#../build/prebuilt/linux-x86/arm-eabi-4.4.0/bin/arm-eabi-g++ -DANDROID -DVFP -DNOCRYPT -DUSE_FILE32API -Wl,-rpath-link=../build/platforms/android-3/arch-arm/usr/lib/,-dynamic-linker=/system/bin/linker -nostdlib -I ../build/platforms/android-3/arch-arm/usr/include/ -mfloat-abi=softfp -mfpu=vfp -fno-short-enums -L ../build/platforms/android-3/arch-arm/usr/lib/ -lc -llog crt0.o minizip/zip.c minizip/ioapi.c shellinabox/service.c shellinabox/launcher.c shellinabox/logging.c shellinabox/hashmap.c webkey.c suinput.c tmp_mongoose.c base64.c  ../build/prebuilt/linux-x86/arm-eabi-4.4.0/arm-eabi/lib/libstdc++.a libpng12.a libjpeg_vfp.a -lz -o webkey_vfp -O2  && ../build/prebuilt/linux-x86/arm-eabi-4.4.0/bin/arm-eabi-strip webkey_vfp && echo OK 
../toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-g++ -Wno-write-strings -mthumb -DANDROID -DNOCRYPT -DUSE_FILE32API -Wl,-rpath-link=../platforms/android-3/arch-arm/usr/lib/,-dynamic-linker=/system/bin/linker -I ../platforms/android-3/arch-arm/usr/include/ -I ../sources/cxx-stl/stlport/stlport/ -fno-short-enums -mfloat-abi=softfp -mfpu=vfp -L ../platforms/android-3/arch-arm/usr/lib/ -lc -llog minizip/zip.c minizip/ioapi.c shellinabox/service.c shellinabox/launcher.c shellinabox/logging.c shellinabox/hashmap.c webkey.c suinput.c tmp_mongoose.c base64.c -fno-exceptions -fno-rtti ../sources/cxx-stl/stlport/libs/armeabi/libstlport_static.a libpng12.a libjpeg.a -lz -o webkey -O2  && ../toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-strip webkey && echo OK 
